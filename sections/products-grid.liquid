{{ 'nerd-image-grid.css' | asset_url | stylesheet_tag }}

{%- if section.settings.enable_quick_add -%}
  {{ 'quick-add.css' | asset_url | stylesheet_tag }}
  <script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

{% liquid

  assign count = section.blocks.size
  if count == 1
    assign grid_1_class = "nerd--grid-1-desktop nerd--grid-1-tablet nerd--grid-1-mobile"
  elsif count == 2
    assign grid_1_class = "nerd--grid-2-desktop nerd--grid-1-tablet"
    assign grid_2_class = " nerd--grid-1-desktop nerd--grid-1-tablet nerd--grid-1-mobile"
  elsif count == 3
    assign grid_1_class = "nerd--grid-2-desktop nerd--grid-1-tablet"
    assign grid_2_class = "nerd--grid-row-2 nerd--grid-1-desktop nerd--grid-2-tablet nerd--grid-1-mobile"
  else
    assign grid_1_class = "nerd--grid-2-desktop nerd--grid-1-tablet"
    assign grid_2_class = "nerd--grid-row-2 nerd--grid-2-desktop nerd--grid-2-tablet nerd--grid-1-mobile"
 
    
  endif

%}

<style>
  .nerd--product-grid-title {
    text-transform: uppercase;
    padding: 10px;
  }
  .nerd--products-grid a{
    color: rgba(var(--color-foreground));
  }

  .nerd--product-grid-collection{
    margin: 10px;
    padding: 5px 10px;
    background-color: rgba(var(--color-button),var(--alpha-button-background));
  }

  .nerd--product-grid-collection-sm{
    margin: 5px;
    padding: 2.5px 5px;
    background-color: rgba(var(--color-button),var(--alpha-button-background));
    font-size: small;
  }

  .nerd--products-grid-title-lg{
    text-transform: uppercase;
    font-size: 3rem;
    font-weight: 600;
  }

   .nerd--products-grid-title-md{
    text-transform: uppercase;
    font-size: 2rem;
    font-weight: 600; 
  }

  .nerd--products-grid--content-md{
    padding: 2rem 0;
  }

  .nerd--products-grid--content-lg{
    padding: 4rem 0; 
  }

  .image-wrapper, .nerd--grid-image-wrapper{
    
     overflow: hidden; 
  }
  .nerd--showme {
    opacity: 0;
    transition: all 0.3s;
  }
  .nerd--showhim {
    cursor: pointer;
  }

  .nerd--showhim:hover .nerd--showme {
    opacity: 1;
  }

  .nerd--image-grid-bigimage, .nerd--image-grid--image {
    transition: all 0.3s;
  }

  .nerd--showhim:hover .nerd--image-grid-bigimage {
    transform: scale(1.05);
    opacity: 0.6 !important;
  }

  .nerd--showhim:hover .nerd--image-grid--image{
     transform: scale(1.05);
    opacity: 0.6 !important;
  }

   @media screen and (max-width: 480px) {
    .nerd--products-grid-title-lg, .nerd--products-grid-title-md{
      font-size: 2rem;
    }

      .nerd--products-grid--content-md, .nerd--products-grid--content-lg{
      padding: 1rem ;
    }

   }

     @media screen and (min-width: 990px){
      .nerd--products-grid-title-md{
      font-size: 1.7rem;
      }
       .nerd--products-grid--content-md{
         padding: 1rem;
       } 

  }
</style>

<div class="nerd--products-grid color-{{ section.settings.color_scheme }}">
  <div class="nerd--grid nerd--grid-gap-sm image-grid {{ grid_1_class }}">
  {% assign first = section.blocks.first %}
        {% assign content_position = first.settings.content_position | prepend: "nerd--absolute-item-" %}
        {% assign product = first.settings.product %}
        {% assign image = product.featured_image %}
    
    <div class="nerd--relative image-wrapper first nerd--image-grid-height-full nerd--showhim">
      <a href="{{ product.url }}">
      {% if count > 0 %}

        {% capture styles %}
          opacity: {{ first.settings.image_opacity }}%;
        {% endcapture %}
        {% if image %}
          {{
             image
           | image_url: width: image.width
           | image_tag: loading: 'lazy', class: 'nerd--image-grid-bigimage', style: styles }}
        {% else %}
          {{ 'product-1' | placeholder_svg_tag: "hw-full bg-cover nerd--image-grid-bigimage" }}
        {% endif %}
      {% else %}
        {{ 'product-1' | placeholder_svg_tag: "hw-full bg-cover nerd--image-grid-bigimage" }}
      {% endif %}

      <div class="nerd--absolute-top-left nerd--product-grid-collection uppercase">
          {{ product.collections.first.title }}
        </div>
    
      <div class="nerd--products-grid--content-lg {{ content_position }} nerd--bg-transparent nerd--flex-col nerd--image-grid-absolute nerd--text-center nerd--product-grid-title">
        
        {% if section.settings.show_title %}
          <div class="nerd--products-grid-title-lg ">
            {{ product.title }}
          </div>
        {% endif %}
      </div>
      <div class="nerd--absolute-item-center nerd--showme">
        {% render 'quick-add', card_product: product, section_id: section_id %}
      </div>
        </a>
    </div>
      
    <div class="nerd--grid nerd--grid-gap-sm nerd--grid-item {{ grid_2_class }} ">
      {% for block in section.blocks %}

        {% if forloop.index > 1 %}
          {% assign product = block.settings.product %}
          {% assign image = product.featured_image %}
          {% capture styles %}
            opacity : {{ block.settings.image_opacity }}%;
          {% endcapture %}
          {% capture classes %}
            nerd--image-grid--image
            {% if count == 2 %}
              nerd--image-grid-height-full
            {% else %}
              nerd--image-grid-height-half
            {% endif %}
          {% endcapture %}
          {% liquid
          assign content_position = "nerd--absolute-item-center"
            if block.settings.content_position == "top" 
              assign content_position = "nerd--absolute-item-top"
            elsif block.settings.content_position == "bottom"
              assign content_position = "nerd--absolute-item-bottom"
            endif
          
          
          
          %}
          
          <div class="nerd--grid-image-wrapper {{ classes }} nerd--relative {% if count==4 and forloop.index==4 %} nerd--grid-colspan-2 {% endif %} nerd--showhim">
            {% if image %}
              {{
                 image
               | image_url: width: image.width
               | image_tag: loading: 'lazy', style: styles, class: classes }}

            {% else %}
              {{ 'product-1' | placeholder_svg_tag: classes }}
            {% endif %}
            <div class="nerd--absolute-top-left uppercase {%- if count==2 and forloop.index==2 -%} nerd--product-grid-collection {%- else -%} nerd--product-grid-collection-sm {%- endif -%}">
          {{ product.collections.first.title }}
        </div>
            
            <div class="nerd--products-grid--content-md {{ content_position }} nerd--flex-col nerd--bg-transparent nerd--image-grid-absolute nerd--text-center">
              {% if section.settings.show_title %}
              <div class="{%- if count==2 and forloop.index==2 -%} nerd--products-grid-title-lg {%- else -%}nerd--products-grid-title-md{%- endif -%}">
                {{ product.title }}
              </div>
                {% endif %}
            </div>
             <div class="nerd--absolute-item-center nerd--showme">
        {% render 'quick-add', card_product: product, section_id: section_id %}
      </div>
          </div>
    
        {% endif %}
      {% else %}
        {% for i in (1..4) %}

          <div class="nerd--grid-item image-wrapper nerd--image-small">
            {{ 'product-1' | placeholder_svg_tag: "hw-full bg-cover" }}
          </div>
        {% endfor %}

      {% endfor %}
    </div>

  </div>

</div>



{% schema %}
  {
    "name": "Proucts Grid",
    "blocks": [
      {
        "name": "t:sections.products_grid.blocks.name",
        "type": "product",
        "limit": 5,
        "settings": [
          {
            "type": "product",
            "id": "product",
            "label": "t:sections.product_grid.blocks.settings.product.label"
          }, {
            "type": "range",
            "id": "image_opacity",
            "min": 10,
            "max": 100,
            "step": 10,
            "unit": "%",
            "default": 90,
            "label": "t:sections.products_grid.blocks.settings.opacity.label"
          }, {
            "type": "select",
            "id": "content_position",
            "default": "bottom",
            "label": "t:sections.products_grid.blocks.settings.content.label",
            "options": [
              {
                "value": "top",
                "label": "t:sections.products_grid.blocks.settings.content.options.top.label"
              }, {
                "value": "center",
                "label": "t:sections.products_grid.blocks.settings.content.options.center.label"
              }, {
                "value": "bottom",
                "label": "t:sections.products_grid.blocks.settings.content.options.bottom.label"
              }
            ]
          }

        ]
      }
    ],
    "settings": [
      {
        "type": "checkbox",
        "id": "show_title",
        "label": "t:sections.products_grid.settings.show_title.label"
      }, {
        "type": "checkbox",
        "id": "enable_quick_add",
        "label": "t:sections.products_grid.settings.quick_add.label"
      }, {
        "type": "color_scheme",
        "id": "color_scheme",
        "default": "background-2",
        "label": "t:sections.all.colors.label"
      }
    ],
    "presets": [
      {
        "name": "Products Grid"
      }
    ]
  }
{% endschema %}